# Project Structure and Compilation
<!-- vscode-markdown-toc -->
* 1. [Project Structure](#ProjectStructure)
* 2. [Compiling](#Compiling)
* 3. [Important Directories](#ImportantDirectories)
* 4. [Compiler Arguments](#CompilerArguments)
* 5. [File Structure](#FileStructure)
* 6. [Pack Version](#PackVersion)
* 7. [Tags](#Tags)

<!-- vscode-markdown-toc-config
	numbering=true
	autoSave=true
	/vscode-markdown-toc-config -->
<!-- /vscode-markdown-toc -->

##  1. <a name='ProjectStructure'></a>Project Structure
MCPPC compiles at the project (datapack) level. An mcpp project looks similar to a datapack:
```
├── pack.mcmeta
├── data
│   ├── <namespace>
│   │   ├── src
│   │   │   ├── (all your .mcpp files)
│   │   ├── include (optional)
│   │   │   ├── (mcpp will put generated .mch files here)
│   │   ├── functions (optional)
│   │   │   ├── (mcpp will put compiled .mcfunction files here)
│   ├── ... more namespaces
├── ...
```
The mcpp project may or may not be the same as the datapack output and include output directories.
##  2. <a name='Compiling'></a>Compiling
A vscode build task for running the compiler is found in 
[/mcppc-build-task.json](../mcppc-build-task.json). In order to work, the compiler must be runned with the cwd in its directory.
##  3. <a name='ImportantDirectories'></a>Important Directories
The two most important directories are the source and output directories (which may be the same). The source directory contains the mcpp files to compile and the output directory is where all of the resulting mcfunction files (and tags) go. Both default to the cwd.

##  4. <a name='CompilerArguments'></a>Compiler Arguments
The compiler has the following arguments:
- -src $path : the source path; defaults to cwd
- -o $path : set the output directory (the datapack); defaults to cwd
  - note: the compiler will issue a warning if the output lacks an pack.mcmeta file, and then get user input as to whether to continue
- -h $path : set the directory to output files that can be used to import precompiled code (.mch files); defaults to cwd
- -I $path : adds a directory for precompiled libraries to import (the one with .mch files)
- -L $path : adds a directory to look for precompiled .mcfunction files that an included library uses
- -x $versionrange : specifies a range of versions (pack formats) to target (min..max)
- -g : add comments to mcfunctions with line number info
- -std : recompiles the standard library
- --std : recompiles the standard library and skips normal compilation
- -vscode $path: generates the tmLanguage used by the vscode extension and writes it to $path (defaults to the generated folder); also stops normal compilation
- more arguments that influence compilation
  - -pedantic : dis-allow anything unsafe
  - -unsafe : allows more unsafe operations
  - -frugal : prevent operations that bloat the line count or strain minecraft
  - -intensive : allows more operations that tax the line count and minecraft
  - -override : overrides any scope-specific flags with the global flag
  - -uuidLookup : allows threads to use uuid lookup tables for non-score locals
  - -werror : elevates all warnings to errors
  - -md: generate the above markdown sublist (skip compilation)
##  5. <a name='FileStructure'></a>File Structure
The compiler recognizes the following important file types:
- .mcpp : an mcpp source file
- .mcfunction : an mcfunction file
- .mch : a file generated by mcppc that contains function / variable information for an mcpp file that was already compiled. This allows different projects to interop without recompilation. They appear similar to .h files but are used differently (you don't write them).
##  6. <a name='PackVersion'></a>Pack Version
MCPPC can target a pack version range. This can be specified as an argument. By default, MCPPC does not assume that any specific version is used.

MCPPC will give a compile error if a feature being used requires a version outside the target range. If not all of the target range meets the version requirement than a warning will be issued instead.

To avoid compile errors, code can be conditionally compiled using a `target` statement:
```mcpp
private int a;
import if mcppc:math; //standard library
target 18.. {
    a = Random.uniform(0,10);
    //this relies on /random
} else target default {
    a = math.random0(10);
    //an alternative that doesn't use /random
}
```
##  7. <a name='Tags'></a>Tags
MCPPC makes tag files if functions request to be in a tag.
These may confilct with / overwrite pre-existing tag files at the destination, so make sure those are in a seperate directory.